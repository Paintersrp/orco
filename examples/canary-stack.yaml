version: "0.1"

stack:
  name: canary-demo
  workdir: .

defaults:
  health:
    cmd:
      command: ["true"]

services:
  api:
    runtime: process
    replicas: 2
    command: ["sleep", "5"]
    env:
      VERSION: v1
    resources:
      cpu: "1.5"
    update:
      strategy: canary
      promoteAfter: 30s
      abortAfterFailures: 3
      observationWindow: 2m

  web:
    runtime: process
    dependsOn:
      - target: api
        require: ready
    command: ["sleep", "2"]
    env:
      API_URL: http://localhost:8080
    resources:
      memory: 64Mi
